<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Roll shift visualizer</title>
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="//unpkg.com">
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <!-- Plotly now loaded on-demand (scatter-only custom build) -->
        <link rel="modulepreload" crossorigin href="/primetals/assets/plotly-core-BAA7vXz2.js">
    <link rel="preload" crossorigin href="/primetals/assets/plotly-core-MGNviBeR.css" as="style">
    <link rel="modulepreload" crossorigin href="/primetals/assets/scatter-FRCx2RfY.js">
    <link rel="modulepreload" crossorigin href="/primetals/assets/core-BKAC6fdO.js">
    <link rel="modulepreload" crossorigin href="/primetals/assets/plotly-scatter-Cp3JySGL.js">
    <link rel="modulepreload" crossorigin href="/primetals/assets/mathjax-l0sNRNKZ.js">
    <script type="module" crossorigin src="/primetals/assets/crownvis-DQTcq7In.js"></script>
    <link rel="modulepreload" crossorigin href="/primetals/assets/initThemeDebug-DWzlb7pU.js">
    <link rel="stylesheet" crossorigin href="/primetals/assets/initThemeDebug-gfCsqRPK.css">
  </head>
  <body>
  <header class="topbar">
      <div class="topbar__inner">
        <nav class="topbar__nav" aria-label="Main">
          <ul class="topbar__links">
            <li><a class="help-btn" href="./" aria-current="page">CrownVis</a></li>
            <li><a class="btn" href="../pfclog/">pfcLog</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main class="app">
      <!-- <header>
        <h1>Roll shift visualizer</h1>
      </header> -->

      <section class="panel card panel--split">
        <div class="panel-left">
          <!-- IMPORTANT: Plotly uses a DIV, not SVG -->
          <div id="plot"></div>

          <div class="controls card controls--bottom">
            <div class="row row--compact">
              <label for="hshift">Horizontal Shift (m)</label>
              <input id="hshift" type="range" min="-0.4" max="0.4" step="0.001" />
            </div>
            <div class="row row--compact">
              <label for="vshift">Vertical shift (m)</label>
              <input id="vshift" type="range" min="-0.001" max="0.001" step="0.00001" />
            </div>

            <div class="meta">
              <span class="badge" id="hbadge">HShift = <strong id="hshiftMM" >0.00</strong> mm</span>
              <span class="badge" id="vbadge">VShift = <strong id="vshiftMM">0.00</strong> mm</span>
              <span class="badge" id="profileFormula">Induced profile = <strong id="profileVal">—</strong> µm</span>
              <span class="badge">x ∈ [−1, 1], N = <span id="npts"></span></span>
            </div>
          </div>
        </div>

        <div class="coeffs card">
          <h2 class="coeffs__title">Coefficients</h2>
          <div class="coeff">
            <label for="a1">a₁ (linear)</label>
            <input id="a1" type="text" inputmode="decimal" />
          </div>
          <div class="coeff">
            <label for="a2">a₂ (quadratic)</label>
            <input id="a2" type="text" inputmode="decimal" />
          </div>
          <div class="coeff">
            <label for="a3">a₃ (cubic)</label>
            <input id="a3" type="text" inputmode="decimal" />
          </div>
          <div class="coeff">
            <label for="a4">a₄ (quartic)</label>
            <input id="a4" type="text" inputmode="decimal" />
          </div>
          <div class="help-btn-wrap">
            <button id="flipPairBtn" type="button" class="help-btn" title="Flip OS-DS">Flip</button>
            <button id="resetCoeffsBtn" type="button" class="help-btn" title="Reset coefficients to session start">Reset</button>
            <button id="tokenCoeffsBtn" type="button" class="help-btn" title="Reset to hardcoded defaults">Default</button>
          </div>
          <div class="help-btn-wrap toggles-row">
            <label class="toggle-label">
              <input id="fixShiftChk" type="checkbox" title="Keep current shift when editing coefficients"/> Fix H-shift
            </label>
            <label class="toggle-label">
              <input id="fixVShiftChk" type="checkbox" checked title="Keep current vertical shift when editing coefficients"/> Fix V-shift
            </label>
            <label class="toggle-label">
              <input id="mirrorToggleChk" type="checkbox" checked title="Show mirrored fish, fills & diff curve"/> Fish mode
            </label>
          </div>
          <div class="poly-plot-wrap">
            <h3 class="mini-title">Diameter Top Roll (m)</h3>
            <div id="polyPlot"></div>
          </div>
          <div class="help-btn-wrap">
            <button id="helpBtn" type="button" class="help-btn" title="Usage & formulas">Usage / Formulas</button>
          </div>
        </div>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <label class="debug-toggle"><input id="darkToggle" type="checkbox" /> Dark mode</label>
      <label class="debug-toggle"><input id="debugToggle" type="checkbox" /> Bogdan's layer</label>
    </footer>

  <!-- MathJax now lazy-loaded only when help popup opens -->
  </body>
  </html>
