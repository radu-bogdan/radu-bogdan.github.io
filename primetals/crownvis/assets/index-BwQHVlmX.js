const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-BuHa7EHX.js","assets/index-T_90fFyv.js","assets/index-MGNviBeR.css","assets/scatter-Bes2ZPQW.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();function H(e,t){return e*(t.a1+e*(t.a2+e*(t.a3+e*t.a4)))}function A(e,t){return e.map(o=>.5*H(-o,t))}function K(e,t){return e.map(o=>-.5*H(+o,t))}function we(e,t,o){const r=e.map(l=>l-t),i=e.map(l=>l+t),n=A(r,o),a=K(i,o);return n.map((l,d)=>l-a[d])}function _(e){const t=3*e.a3;return Math.abs(t)<1e-16?0:-e.a2/t}function Ee(e,t,o){const r=new Array(o),i=(t-e)/(o-1);for(let n=0;n<o;n++)r[n]=e+n*i;return r}const $e=50,O=.5,_e=160,Le=6,fe={a1:-.000276329818577996,a2:.0002052381459230004,a3:.0007542456220678692,a4:0};function Me(){return{coeffs:{...fe},shift:0,vshift:0,x:Ee(-1,1,$e)}}function Pe(e){let t={...e,shift:_(e.coeffs)};const o=new Set;function r(){return t}function i(s){t={...t,...s},o.forEach(c=>c())}function n(s,c=!0){const f={coeffs:s};c&&(f.shift=_(s)),i(f)}function a(s){i({shift:s})}function l(s){i({vshift:s})}function d(s){return o.add(s),()=>o.delete(s)}return{get:r,set:i,setCoeffs:n,setShift:a,setVShift:l,subscribe:d}}let L={};function ke(e){const t=typeof document<"u"&&document.body.classList.contains("dark");let o="#ffffff",r="#ffffff",i="#e5e9f2",n="#d7dde8",a="#0b1323";if(t&&typeof window<"u"){const d=getComputedStyle(document.body),s=d.getPropertyValue("--surface-card").trim(),c=d.getPropertyValue("--surface-alt").trim(),f=d.getPropertyValue("--color-grid").trim(),g=d.getPropertyValue("--color-border").trim(),m=d.getPropertyValue("--color-ink").trim();o=s||"#273240",r=c||o,i=f||"#445264",n=g||"#445264",a=m||"#f2f6fa"}const l={margin:{l:54,r:12,t:16,b:44},paper_bgcolor:o,plot_bgcolor:r,font:{color:a},xaxis:{title:{text:"OS  ➝  DS",font:{size:12,weight:0},standoff:12},zeroline:!0,zerolinecolor:"#b7791f",gridcolor:i,linecolor:n,mirror:!0,range:e.x,fixedrange:!1},yaxis:{zeroline:!0,zerolinecolor:"#b7791f",gridcolor:i,linecolor:n,mirror:!0,fixedrange:!1},hovermode:"closest",showlegend:!1};return L.x&&L.x.every(d=>isFinite(d))&&(l.xaxis.range=[...L.x]),L.y&&L.y.every(d=>isFinite(d))&&(l.yaxis.range=[...L.y]),l}function Te(e){e._zoomPersistBound||(e.on("plotly_relayout",t=>{const o=t["xaxis.range[0]"]!==void 0&&t["xaxis.range[1]"]!==void 0,r=t["yaxis.range[0]"]!==void 0&&t["yaxis.range[1]"]!==void 0;o&&(L.x=[t["xaxis.range[0]"],t["xaxis.range[1]"]]),r&&(L.y=[t["yaxis.range[0]"],t["yaxis.range[1]"]])}),e.on("plotly_doubleclick",()=>{L={}}),e._zoomPersistBound=!0)}function te(){L={}}function T(e){return e.toExponential(Le)}function j(e,t,o,r,i,n,a,l,d){const s=document.createElement("div");s.className="coeff-drag",s.innerHTML="<span>±"+(O*100).toFixed(0)+"%</span>",e.appendChild(s);const c=s.querySelector("span");let f=0,g=0,m=!1;const v=y=>Number(String(y).trim().replace(",",".")),M=y=>{y.preventDefault(),y.stopPropagation(),m=!0,s.classList.add("active"),f=y.clientX,g=v(t.value),(!isFinite(g)||g===0)&&(g=r.coeffs[o]),s.setPointerCapture(y.pointerId)},C=y=>{if(!m)return;const w=y.clientX-f,P=Math.max(-1,Math.min(1,w/_e)),k=1+P*O,B=g*k;t.value=T(B),r.coeffs[o]=B,r.shift=_(r.coeffs),i.value=String(r.shift),n.textContent=(r.shift*1e3).toFixed(2),c.textContent=(P*O*100).toFixed(1)+"%",a()},S=y=>{m&&(m=!1,s.classList.remove("active"),c.textContent="±"+(O*100).toFixed(0)+"%",s.releasePointerCapture(y.pointerId),l(),d&&d())};s.addEventListener("pointerdown",M),s.addEventListener("pointermove",C),s.addEventListener("pointerup",S),s.addEventListener("pointerleave",S)}function q(e,t,o){const r=new Date(Date.now()+o*864e5).toUTCString();document.cookie=`${e}=${encodeURIComponent(t)}; expires=${r}; path=/`}function Q(e){const t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([.$?*|{}()\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}function ee(){const e=Q("coeffA123");if(!e)return{coeffs:null,dark:null};const t=e.split("|");if(t.length<4)return{coeffs:null,dark:null};const o=t.slice(0,4).map(n=>Number(n));if(o.some(n=>!isFinite(n)))return{coeffs:null,dark:null};const r={a1:o[0],a2:o[1],a3:o[2],a4:o[3]},i=t.length>=5?t[4]==="1":null;return{coeffs:r,dark:i}}function ue(e,t){const{a1:o,a2:r,a3:i,a4:n}=e;q("coeffA123",`${o}|${r}|${i}|${n}|${t?"1":"0"}`,365)}function Ce(e,t){const o=ee();ue(o.coeffs??t,e)}const D=e=>Number(String(e).trim().replace(",","."));function ne(e,t){const{a2:o,a3:r}=e;if(!isFinite(o)||!isFinite(r)||!isFinite(t))return"—";const n=.5*(-2*o-6*r*t)*1e6;if(!isFinite(n))return"—";const a=Math.abs(n);return a>=1e3?n.toExponential(2):n.toFixed(a>=100?1:a>=10?2:3)}function Se(e,t){const o=$("a1"),r=$("a2"),i=$("a3"),n=$("a4"),a=ee();a.coeffs&&(e.coeffs={...e.coeffs,...a.coeffs},e.shift=_(e.coeffs));const l={...e.coeffs};[o,r,i,n].forEach(x=>{const u=x.parentElement;if(!(!u||!u.classList.contains("coeff"))&&!x.closest(".coeff-row")){const p=document.createElement("div");p.className="coeff-row",x.replaceWith(p),p.appendChild(x);const h=document.createElement("button");h.type="button",h.className="flip-btn",h.textContent="±",h.title="Flip sign",p.appendChild(h)}});const d=[{btn:o.parentElement.querySelector(".flip-btn"),key:"a1",input:o},{btn:r.parentElement.querySelector(".flip-btn"),key:"a2",input:r},{btn:i.parentElement.querySelector(".flip-btn"),key:"a3",input:i},{btn:n.parentElement.querySelector(".flip-btn"),key:"a4",input:n}],s=$("shift"),c=$("vshift"),f=$("crownMM"),g=$("vshiftMM"),m=$("crownVal"),v=$("npts"),M=document.getElementById("flipPairBtn"),C=document.getElementById("resetCoeffsBtn"),S=document.getElementById("tokenCoeffsBtn"),y=()=>{document.activeElement!==o&&(o.value=T(e.coeffs.a1)),document.activeElement!==r&&(r.value=T(e.coeffs.a2)),document.activeElement!==i&&(i.value=T(e.coeffs.a3)),document.activeElement!==n&&(n.value=T(e.coeffs.a4)),s.value=String(e.shift),c.value=String(e.vshift??0),f.textContent=(e.shift*1e3).toFixed(2),m.textContent=ne(e.coeffs,e.shift),g.textContent=((e.vshift??0)*1e3).toFixed(2),v.textContent=String(e.x.length)};y();const w=()=>ue(e.coeffs,document.body.classList.contains("dark")),P=()=>{const x=D(o.value),u=D(r.value),p=D(i.value),h=D(n.value);[x,u,p,h].some(E=>!isFinite(E))||(e.coeffs={a1:x,a2:u,a3:p,a4:h},e.shift=_(e.coeffs),y(),t(),w())},k=(x,u)=>{const p=D(x.value);if(!isFinite(p)){x.value=T(e.coeffs[u]);return}e.coeffs[u]=p,e.shift=_(e.coeffs),x.value=T(e.coeffs[u]),y(),t(),w()};[o,r,i,n].forEach(x=>x.addEventListener("input",P)),o.addEventListener("blur",()=>k(o,"a1")),r.addEventListener("blur",()=>k(r,"a2")),i.addEventListener("blur",()=>k(i,"a3")),n.addEventListener("blur",()=>k(n,"a4"));const B=[o,r,i,n,s,c];B.forEach((x,u)=>x.addEventListener("keydown",p=>{if(p.key==="Enter"){p.preventDefault();const h=B[u+1];h?h.focus():x.blur()}})),s.addEventListener("input",()=>{e.shift=Number(s.value),f.textContent=(e.shift*1e3).toFixed(2),te(),m.textContent=ne(e.coeffs,e.shift),t()}),c.addEventListener("input",()=>{e.vshift=Number(c.value),g.textContent=((e.vshift??0)*1e3).toFixed(2),te(),t()}),j(o.parentElement,o,"a1",e,s,f,t,y,w),j(r.parentElement,r,"a2",e,s,f,t,y,w),j(i.parentElement,i,"a3",e,s,f,t,y,w),j(n.parentElement,n,"a4",e,s,f,t,y,w),[o,r,i,n].forEach(x=>{const u=x.parentElement;if(!u)return;const p=u.querySelector(".coeff-drag"),h=u.querySelector(".flip-btn");if(p&&h){const E=Array.from(u.children);E[1]!==p&&u.insertBefore(p,E[1]||null),p.nextElementSibling!==h&&p.after(h)}}),o.tabIndex=1,r.tabIndex=2,i.tabIndex=3,n.tabIndex=4;const F=[o,r,i,n];return F.forEach((x,u)=>{x.addEventListener("keydown",p=>{if(p.key==="Tab"){if(!p.shiftKey&&u===F.length-1){p.preventDefault();const h=F[0];h.focus(),h.select()}else if(p.shiftKey&&u===0){p.preventDefault();const h=F[F.length-1];h.focus(),h.select()}}})}),d.forEach(({btn:x,key:u,input:p})=>{x&&x.addEventListener("click",()=>{const h=e.coeffs[u];typeof h!="number"||!isFinite(h)||(e.coeffs[u]=-h,p.value=T(e.coeffs[u]),e.shift=_(e.coeffs),y(),t(),w())})}),M&&M.addEventListener("click",()=>{const{a1:x,a3:u}=e.coeffs;isFinite(x)&&(e.coeffs.a1=-x),isFinite(u)&&(e.coeffs.a3=-u),e.shift=_(e.coeffs),y(),t(),w()}),C&&C.addEventListener("click",()=>{e.coeffs={...l},e.shift=_(e.coeffs),y(),t(),w()}),S&&S.addEventListener("click",()=>{e.coeffs={...fe},e.shift=_(e.coeffs),y(),t(),w()}),{refresh:y}}function $(e){const t=document.getElementById(e);if(!t)throw new Error(`#${e} not found`);return t}function Be(e=document){const t=window;t.MathJax&&t.MathJax.typesetPromise&&t.MathJax.typesetPromise([e])}const Fe=String.raw`
Assuming we have at most 3rd order polynomials, the diameter of the top roll is given by
$$D(x) = a_1 x + a_2 x^2 + a_3 x^3$$
Then the bottom contour of the top roll $T(x)$ is described by
$$
\red{T(x)}=\tfrac12 d(-x)=\tfrac12 a_1 x + \tfrac12 a_2 x^2 + \tfrac12 a_3 x^3
$$
Similarly, we define the top contour of the bottom roll by
$$
\blue{B(x)}=-T(-x)
$$
Why? Well, it has to be point-symmetric around the origin in relation to $t(x)$. \nl
The gap profile at every $x$, when applying a shift $s$ is given by
$$
\begin{align*}
G(s,x) &= {T(x-s)} - {B(x+s)} = T(x-s)+T(-x-s) \\
&=\tfrac{a_1}2{(x-s)} + \tfrac{a_2}2{(x-s)^2} + \tfrac{a_3}2{(x-s)^3}
  + \big[\tfrac{a_1}2{(-x-s)} + \tfrac{a_2}2{(-x-s)^2} + \tfrac{a_3}2{(-x-s)^3}\big] \\
&=\tfrac{a_1}2\big[{(x-s)}+{(-x-s)}\big]
  +\tfrac{a_2}2\big[{(x-s)^2}+{(-x-s)^2}\big]
  +\tfrac{a_3}2\big[{(x-s)^3}+{(-x-s)^3}\big] \\
&=-a_1s + a_2(x^2 + s^2) + a_3(-3sx^2 - s^3) \\
&=-a_1s + a_2s^2 - a_3s^3 + x^2(a_2 - 3a_3s)
\end{align*}
$$
Thus we can define
$$c(s)=a_2 - 3a_3s,$$
which describes the quadratic contour part of the gap. On the other hand, we can state the inverse relationship
$$
s(c)=\frac{a_2-c}{3a_3}.
$$
What do we observe? First, $s(0)=\frac{-a_2}{3a_3}$. This is the shift position for which the gap is "constant" along the width, \nl
i.e. the quadratic part vanishes entirely. \nl
Moreover, the slope of the shift-gap relationship solely depends on the sign of $a_3$. \nl
So what about the equivalent crown? Well, from the perspective of the roll, the signs switch completly!


\nl\nl\nl

$$
=\,a(2s)
  +b\big(2x^2+2s^2\big)
  +c\big(6sx^2+2s^3\big)
$$

$$
=\,2as+\underbrace{(2b+6cs)}_{c(s)}x^2+2bs^2+2cs^3
$$

$$
\text{Thus } c(s)=2b+6cs
\quad\Rightarrow\quad
c(s)=0 \;\; \Longleftrightarrow \;\; s=-\frac{b}{3c}.
$$



### Polynomial Model

The top roll diameter profile $D(x)$ is modeled by a polynomial in normalized lateral position $x \in [-1,1]$:

$$ D(x) = a_1 x + a_2 x^2 + a_3 x^3 + a_4 x^4 $$

Coefficients can be typed directly or adjusted by dragging the numeric overlays. The lateral shift $\hat{x}$ is recomputed from coefficients to recenter the profile.

### Crown Metric

The displayed crown in micrometers is computed from the coefficients and the shift:

$$ C = -2 a_2 - 6 a_3 \, \hat{x} $$

where $\hat{x}$ is the automatically chosen shift.

### Vertical Shift

The vertical shift adds a constant offset to the diameter curve for visual alignment; it does not change the crown formula.

### Drag & Drop Text

You can drag a .txt file onto the main plot to inspect its contents in a movable popup. This help window uses the same component infrastructure.

### Shortcuts & Tips

- Enter moves to the next input
- Horizontal shift slider adjusts lateral alignment
- Vertical shift slider makes fine visual adjustments (in mm shown below)
- You can re-open this help at any time with the Usage / Formulas button

Math is rendered client-side via MathJax.
`;let U=null;function Ie(){if(typeof window>"u")return Promise.resolve();const e=window;return e.MathJax&&e.MathJax.startup&&e.MathJax.typesetPromise?Promise.resolve(e.MathJax):(U||(U=new Promise((t,o)=>{const r="/primetals/crownvis/",i=r.replace(/\/$/,"")+"/vendor/input/tex/extensions";e.MathJax={loader:{paths:{tex:i},load:["[tex]/color","[tex]/ams"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],packages:{"[+]":["ams","color"]},macros:{red:["{\\color{red}{#1}}",1],blue:["{\\color{blue}{#1}}",1],green:["{\\color{green}{#1}}",1],purple:["{\\color{purple}{#1}}",1]}},svg:{fontCache:"global"},startup:{typeset:!1}};const n=[r.replace(/\/$/,"")+"/vendor/mathjax-tex-svg.js",r.replace(/\/$/,"")+"/vendor/mathjax-tex-svg-full.js"];let a=0;const l=()=>{if(a>=n.length){o(new Error("Failed to load MathJax"));return}const d=n[a++],s=document.createElement("script");s.src=d,s.async=!0,s.onload=()=>{(e.MathJax.startup?.promise||Promise.resolve()).then(()=>t(e.MathJax))},s.onerror=()=>{s.remove(),l()},document.head.appendChild(s)};l()})),U)}function De(){const e=document.getElementById("helpBtn");e&&(e.addEventListener("click",()=>oe()),Q("helpOpened")==="1"&&setTimeout(()=>{document.querySelector(".help-popup")||oe()},0))}function oe(){document.querySelectorAll(".help-popup").forEach(n=>n.remove());const e=document.createElement("div");e.className="text-popup help-popup card",e.innerHTML=`
    <div class="text-popup__header">
      <strong class="text-popup__title">Usage & Formulas</strong>
      <div class="text-popup__actions">
        <button type="button" class="text-popup__max" aria-label="Maximize" title="Maximize">⛶</button>
        <button type="button" class="text-popup__close" aria-label="Close">✕</button>
      </div>
    </div>
    <div class="text-popup__body">${qe(Fe)}</div>
  `,document.body.appendChild(e),e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)";const t=e.querySelector(".text-popup__close"),o=e.querySelector(".text-popup__max"),r=e.querySelector(".text-popup__header"),i=n=>{o&&(n?(e.classList.add("help-popup--max"),e.style.transform="translate(-50%,-50%)",e.style.top="50%",e.style.left="50%",e.style.width="90vw",e.style.height="90vh",e.style.maxWidth="90vw",e.style.maxHeight="90vh",o.textContent="↙",o.title="Restore",o.setAttribute("aria-label","Restore")):(e.classList.remove("help-popup--max"),e.style.width="720px",e.style.maxWidth="760px",e.style.height="",e.style.maxHeight="72vh",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",o.textContent="⛶",o.title="Maximize",o.setAttribute("aria-label","Maximize")))};t&&(t.addEventListener("pointerdown",n=>n.stopPropagation()),t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),q("helpOpened","",-1),e.remove()})),o&&(o.addEventListener("pointerdown",n=>n.stopPropagation()),o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();const a=!e.classList.contains("help-popup--max");i(a),q("helpMax",a?"1":"0",365)})),r&&r.addEventListener("dblclick",n=>{n.preventDefault(),n.stopPropagation();const a=!e.classList.contains("help-popup--max");i(a),q("helpMax",a?"1":"0",365)}),i(Q("helpMax")==="1"),Ae(e.querySelector(".text-popup__header"),e),Ie().then(()=>Be(e)),q("helpOpened","1",365)}function Ae(e,t){if(!e)return;e.style.cursor="move";let o=0,r=0,i=0,n=0,a=!1;const l=c=>{if(a=!0,o=c.clientX,r=c.clientY,t.style.transform){const g=t.getBoundingClientRect();t.style.transform="",t.style.left=g.left+"px",t.style.top=g.top+"px"}const f=t.getBoundingClientRect();i=f.left,n=f.top,t.style.position="fixed",e.setPointerCapture(c.pointerId)},d=c=>{a&&(t.style.left=i+c.clientX-o+"px",t.style.top=n+c.clientY-r+"px")},s=c=>{if(a){a=!1;try{e.releasePointerCapture(c.pointerId)}catch{}}};e.addEventListener("pointerdown",l),e.addEventListener("pointermove",d),e.addEventListener("pointerup",s),e.addEventListener("pointerleave",s)}function qe(e){const t=[],o=e.replace(/\r\n?/g,`
`).split(/\n/);let r=[];const i=()=>{if(!r.length)return;const n=r.join(`
`).trimEnd();n.trim()&&t.push({type:"para",content:n}),r=[]};for(let n=0;n<o.length;n++){let a=o[n];const l=a.trim();if(l===""){i();continue}if(l==="$$"){i();let d=[];for(n++;n<o.length&&o[n].trim()!=="$$";)d.push(o[n]),n++;t.push({type:"display",content:`$$
`+d.join(`
`)+`
$$`});continue}if(/^\$\$.*\$\$\s*%?\s*$/.test(l)){i(),t.push({type:"display",content:l.replace(/\s*%\s*$/,"")});continue}r.push(a)}return i(),t.map(n=>n.type==="display"?n.content:Re(n.content)).join(`
`)}function Re(e){const t=e.trim();if(!t)return"";if(/^###\s+/.test(t)){const r=t.replace(/^###\s+/,"").trim();return`<h3>${Z(r)}</h3>`}const o=t.split(/\n/);return o.every(r=>!r||/^-\s+/.test(r))?`<ul>${o.filter(i=>i).map(i=>`<li>${ie(i.replace(/^-\s+/,"").trim())}</li>`).join("")}</ul>`:`<p>${ie(o.join(" ").replace(/\s+/g," ").trim())}</p>`}function ie(e){const t=[];let o=0;const r=/\${1,2}[^$]+?\${1,2}/g;let i;const n="\0BR\0",a=s=>s.replace(/[ \t]*\\nl[ \t]*/g,n);for(;i=r.exec(e);){const s=e.slice(o,i.index);if(s){const c=a(s);t.push(Z(c))}t.push(i[0]),o=i.index+i[0].length}const l=e.slice(o);if(l){const s=a(l);t.push(Z(s))}let d=t.join("");return d=d.replace(new RegExp(n,"g"),"<br/>"),d}function Z(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ne(e,t){Se(e,t),De()}const Oe="modulepreload",je=function(e){return"/primetals/crownvis/"+e},re={},se=function(t,o,r){let i=Promise.resolve();if(o&&o.length>0){let s=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};var a=s;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");i=s(o.map(c=>{if(c=je(c),c in re)return;re[c]=!0;const f=c.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":Oe,f||(m.as="script"),m.crossOrigin="",m.href=c,d&&m.setAttribute("nonce",d),document.head.appendChild(m),f)return new Promise((v,M)=>{m.addEventListener("load",v),m.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return i.then(l=>{for(const d of l||[])d.status==="rejected"&&n(d.reason);return t().catch(n)})};let J=null;async function ze(){return typeof window<"u"&&window.Plotly?window.Plotly:(J||(J=(async()=>{try{typeof window<"u"&&(window.global=window.global||window,globalThis.global=globalThis.global||globalThis)}catch{}const e=(await se(async()=>{const{default:o}=await import("./core-BuHa7EHX.js").then(r=>r.c);return{default:o}},__vite__mapDeps([0,1,2]))).default,t=(await se(async()=>{const{default:o}=await import("./scatter-Bes2ZPQW.js").then(r=>r.s);return{default:o}},__vite__mapDeps([3,1,2]))).default;return e.register([t]),window.Plotly=e,e})()),J)}const Y=[];let ae=!1;function pe(e){if(typeof window<"u"&&window.Plotly){e(window.Plotly);return}Y.push(()=>e(window.Plotly)),ae||(ae=!0,ze().then(()=>{for(;Y.length;)Y.shift()?.()}))}function Ve(e){const{coeffs:t,shift:o,vshift:r=0,x:i}=e,n=typeof document<"u"&&document.body.classList.contains("dark"),a=n?.3:.1,l=n?.3:.1,d=n?"#ffd6cf":"#b91c1c",s=n?"#cfe8ff":"#1d4ed8",c="Top",f="Bottom",g=14,m=i.map(b=>b+o),v=i.map(b=>b-o),M=A(i,t),C=K(i,t),S=A([-1],t)[0],y=A([1],t)[0],w=S>=y?-1:1,P=w===-1?1:-1,k=A([w],t)[0],B=K([P],t)[0],F=M.map(b=>-b+2*k),x=C.map(b=>-b+2*B),u=M.map(b=>b+r),p=F.map(b=>b+r),h=C.map(b=>b-r),E=x.map(b=>b-r),he=H(o,t),ge=we(i,o,t).map(b=>b-he),xe=[...m,...m.slice().reverse()],ye=[...u,...p.slice().reverse()],be=[...v,...v.slice().reverse()],ve=[...h,...E.slice().reverse()];return{traces:[{x:be,y:ve,fill:"toself",fillcolor:`rgba(0,114,206,${l})`,line:{width:0},hoverinfo:"skip"},{x:xe,y:ye,fill:"toself",fillcolor:`rgba(214,45,32,${a})`,line:{width:0},hoverinfo:"skip"},{x:[v[0],v[0]],y:[h[0],E[0]],mode:"lines",line:{width:2,color:"#0072ce"},hoverinfo:"skip",showlegend:!1},{x:[v[v.length-1],v[v.length-1]],y:[h[h.length-1],E[E.length-1]],mode:"lines",line:{width:2,color:"#0072ce"},hoverinfo:"skip",showlegend:!1},{x:[m[0],m[0]],y:[u[0],p[0]],mode:"lines",line:{width:2,color:"#d62d20"},hoverinfo:"skip",showlegend:!1},{x:[m[m.length-1],m[m.length-1]],y:[u[u.length-1],p[p.length-1]],mode:"lines",line:{width:2,color:"#d62d20"},hoverinfo:"skip",showlegend:!1},{x:m,y:u,name:`top (head @ ${w===-1?"-1":"+1"})`,mode:"lines",line:{width:2,color:"#d62d20"}},{x:m,y:p,name:"top mirror",mode:"lines",line:{width:2,color:"#d62d20"}},{x:v,y:h,name:`bottom (head @ ${P===-1?"-1":"+1"})`,mode:"lines",line:{width:2,color:"#0072ce"}},{x:v,y:E,name:"bottom mirror",mode:"lines",line:{width:2,color:"#0072ce"}},{x:i,y:ge,name:"d(x, shift) − const",mode:"lines",line:{width:2,dash:"dash",color:"#6b7280"}},(()=>{const b=Math.floor(i.length/2);return{x:[m[b]],y:[(u[b]+p[b])/2],text:[c],mode:"text",textfont:{color:d,size:g},hoverinfo:"skip",showlegend:!1}})(),(()=>{const b=Math.floor(i.length/2);return{x:[v[b]],y:[(h[b]+E[b])/2],text:[f],mode:"text",textfont:{color:s,size:g},hoverinfo:"skip",showlegend:!1}})()],headSide:w,bottomHeadSide:P}}function He(e){const t=document.getElementById("polyPlot");t&&pe(o=>{const{x:r,coeffs:i}=e,n=r.map(c=>H(c,i)),a=typeof document<"u"&&document.body.classList.contains("dark");let l="#eee",d="#444",s="#ffffff";if(a){const c=getComputedStyle(document.body),f=c.getPropertyValue("--surface-alt").trim(),g=c.getPropertyValue("--color-ink").trim(),m=c.getPropertyValue("--color-grid").trim();s=f||"#2f3d4c",l=m||"#445264",d=g||"#f2f6fa"}o.react(t,[{x:r,y:n,mode:"lines",line:{width:2,color:d},hoverinfo:"x+y"}],{margin:{l:30,r:6,t:4,b:24},paper_bgcolor:s,plot_bgcolor:s,xaxis:Object.assign({tickfont:{size:10,color:a?"#e5e7eb":"#0b1323"},title:"",gridcolor:l,linecolor:l},a?{zeroline:!0,zerolinecolor:"#ffffff"}:{}),yaxis:Object.assign({tickfont:{size:10,color:a?"#e5e7eb":"#0b1323"},title:"",gridcolor:l,linecolor:l},a?{zeroline:!0,zerolinecolor:"#ffffff"}:{}),showlegend:!1},{displayModeBar:!1,staticPlot:!1,responsive:!0})})}function X(e){const t=document.getElementById("plot");t&&pe(o=>{const{traces:r}=Ve(e),i=document.getElementById("shift");let n=-1,a=1;if(i){const s=parseFloat(i.min),c=parseFloat(i.max);if(isFinite(s)&&isFinite(c)){const f=Math.max(Math.abs(s),Math.abs(c));n=-1-f,a=1+f}}const l=ke({x:[n,a]}),d={displayModeBar:!1,responsive:!0,staticPlot:!1};o.react(t,r,l,d),Te(t),He(e)})}function Xe(e){const t=document.body;let o=0;const r=()=>e.classList.add("drop-hover"),i=()=>e.classList.remove("drop-hover"),n=s=>{s.dataTransfer&&ce(s.dataTransfer)&&(o++,s.preventDefault(),r())},a=s=>{s.dataTransfer&&ce(s.dataTransfer)&&(s.preventDefault(),s.dataTransfer.dropEffect="copy")},l=s=>{if(!s.relatedTarget||!t.contains(s.relatedTarget)){o=0,i();return}o=Math.max(0,o-1),o===0&&i()},d=s=>{if(!s.dataTransfer)return;s.preventDefault(),o=0,i();const c=[...s.dataTransfer.files].find(g=>Ue(g));if(!c)return;const f=new FileReader;f.onload=()=>{const g=String(f.result??"");Je(c.name,g)},f.readAsText(c)};t.addEventListener("dragenter",n),t.addEventListener("dragover",a),t.addEventListener("dragleave",l),t.addEventListener("drop",d),window.addEventListener("dragover",s=>s.preventDefault()),window.addEventListener("drop",s=>s.preventDefault())}function ce(e){return[...e.items||[]].some(t=>t.kind==="file"&&/text|plain/.test(t.type)||/\.txt$/i.test(t.getAsFile()?.name||""))}function Ue(e){return/text|plain/.test(e.type)||/\.txt$/i.test(e.name)}function Je(e,t){let r=!1;t.length>1e5&&(t=t.slice(0,1e5)+`
… (truncated)`,r=!0);const i=document.querySelector(".text-popup");i&&i.remove();const n=document.createElement("div");n.className="text-popup card",n.innerHTML=`
    <div class="text-popup__header">
      <strong class="text-popup__title" title="${W(e)}">${W(e)}</strong>
      <div class="text-popup__actions">
        ${r?'<span class="text-popup__trunc">truncated</span>':""}
        <button type="button" class="text-popup__close" aria-label="Close">✕</button>
      </div>
    </div>
    <pre class="text-popup__body"><code>${W(t)}</code></pre>
  `,document.body.appendChild(n);const a=n.querySelector(".text-popup__header"),l=n.querySelector(".text-popup__close");l&&(l.addEventListener("pointerdown",d=>d.stopPropagation()),l.addEventListener("click",d=>{d.preventDefault(),n.remove()})),Ye(a,n)}function W(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Ye(e,t){if(!e)return;e.style.cursor="move";let o=0,r=0,i=0,n=0,a=!1;const l=c=>{if(c.target.closest(".text-popup__actions"))return;a=!0,o=c.clientX,r=c.clientY;const f=t.getBoundingClientRect();i=f.left,n=f.top,t.style.position="fixed",e.setPointerCapture(c.pointerId)},d=c=>{if(!a)return;const f=c.clientX-o,g=c.clientY-r;t.style.left=i+f+"px",t.style.top=n+g+"px"},s=c=>{if(a){a=!1;try{e.releasePointerCapture(c.pointerId)}catch{}}};e.addEventListener("pointerdown",l),e.addEventListener("pointermove",d),e.addEventListener("pointerup",s),e.addEventListener("pointerleave",s)}const R="__dbgHoverOutline",N="__dbgInspector",V="__dbgToast";function We(){document.body.classList.contains("debug")&&(Ke(),Ze(),Qe(),nt())}function Ge(){document.querySelectorAll("[data-debug]").forEach(e=>e.removeAttribute("data-debug")),[R,N,V].forEach(e=>{const t=document.getElementById(e);t&&t.remove()}),document.body.classList.remove("debug-dim")}function Ke(){if(!document.getElementById(R)){const e=document.createElement("div");e.id=R,e.className="debug-hover-outline",document.body.appendChild(e)}if(!document.getElementById(N)){const e=document.createElement("div");e.id=N,e.className="debug-inspector",document.body.appendChild(e)}if(!document.getElementById(V)){const e=document.createElement("div");e.id=V,e.className="debug-toast",document.body.appendChild(e)}}function Ze(){document.querySelectorAll("div").forEach(e=>{if(!e.hasAttribute("data-debug")){const t=e.id?`#${e.id}`:"",o=[...e.classList].join(".")||"";(t||o)&&e.setAttribute("data-debug",`div${t}${o?"."+o:""}`)}})}function Qe(){const e=document.getElementById(R),t=document.getElementById(N),o=document.getElementById(V);let r=null;document.addEventListener("pointermove",i=>{const n=i.target;if(!document.body.classList.contains("debug")||!n||n===document.body||n.id===R||n.id===N)return;if(r===n){le(t,i.clientX,i.clientY);return}r=n;const a=n.getBoundingClientRect();e.style.left=a.left+"px",e.style.top=a.top+"px",e.style.width=a.width+"px",e.style.height=a.height+"px",t.innerHTML=et(n,a),le(t,i.clientX,i.clientY)},{passive:!0}),document.addEventListener("click",i=>{if(!document.body.classList.contains("debug"))return;const n=i.target;if(!n)return;i.preventDefault(),i.stopPropagation();const a=me(n);a&&(navigator.clipboard.writeText(a).catch(()=>{}),tt(o,`Copied: ${a}`))},!0)}function le(e,t,o){const r=window.innerWidth,i=window.innerHeight,n=e.getBoundingClientRect();let a=t+10,l=o+10;a+n.width>r-8&&(a=r-n.width-8),l+n.height>i-8&&(l=i-n.height-8),e.style.left=a+"px",e.style.top=l+"px"}function et(e,t){const o=e.tagName.toLowerCase(),r=e.id?`#${e.id}`:"",i=[...e.classList].join(".")||"",n=`${Math.round(t.width)}×${Math.round(t.height)}`,a=me(e);return`<strong>${o}${r}${i?"."+i:""}</strong> <code>${n}</code><br/><code>${ot(a||"")}</code>`}function me(e){if(!(e instanceof Element))return null;const t=[];let o=e;for(;o&&o!==document.body;){let r=o.tagName.toLowerCase();if(o.id){r=`#${o.id}`,t.unshift(r);break}const i=[...o.classList].slice(0,3).join(".");if(i)r+="."+i.replace(/\.+/g,".");else{const n=Array.from(o.parentElement?.children||[]).filter(a=>a.tagName===o.tagName);if(n.length>1){const a=n.indexOf(o)+1;r+=`:nth-of-type(${a})`}}t.unshift(r),o=o.parentElement}return t.join(" > ")}function tt(e,t){e.textContent=t,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1600)}function nt(){document.addEventListener("keydown",e=>{document.body.classList.contains("debug")&&e.key==="d"&&document.body.classList.toggle("debug-dim")})}function ot(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}(()=>{const{dark:e}=ee();e&&document.body.classList.add("dark")})();const I=Pe(Me());Ne(I.get(),()=>X(I.get()));X(I.get());const de=document.getElementById("plot");de&&Xe(de);I.subscribe(()=>X(I.get()));const G=document.getElementById("debugToggle");G&&G.addEventListener("change",()=>{const e=G.checked;document.body.classList.toggle("debug",e),e?requestAnimationFrame(()=>We()):Ge()});const z=document.getElementById("darkToggle");z&&(z.checked=document.body.classList.contains("dark"),z.addEventListener("change",()=>{document.body.classList.add("theme-changing"),requestAnimationFrame(()=>{const e=z.checked;document.body.classList.toggle("dark",e),Ce(e,I.get().coeffs),setTimeout(()=>document.body.classList.remove("theme-changing"),60),X(I.get())})}));
