(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=o(i);fetch(i.href,n)}})();function j(e,t){return e*(t.a1+e*(t.a2+e*(t.a3+e*t.a4)))}function A(e,t){return e.map(o=>.5*j(-o,t))}function W(e,t){return e.map(o=>-.5*j(+o,t))}function me(e,t,o){const s=e.map(l=>l-t),i=e.map(l=>l+t),n=A(s,o),c=W(i,o);return n.map((l,f)=>l-c[f])}function L(e){const t=3*e.a3;return Math.abs(t)<1e-16?0:-e.a2/t}function he(e,t,o){const s=new Array(o),i=(t-e)/(o-1);for(let n=0;n<o;n++)s[n]=e+n*i;return s}const ge=50,N=.5,xe=160,ye=6,se={a1:-.000276329818577996,a2:.0002052381459230004,a3:.0007542456220678692,a4:0};function be(){return{coeffs:{...se},shift:0,vshift:0,x:he(-1,1,ge)}}function ve(e){let t={...e,shift:L(e.coeffs)};const o=new Set;function s(){return t}function i(r){t={...t,...r},o.forEach(a=>a())}function n(r,a=!0){const m={coeffs:r};a&&(m.shift=L(r)),i(m)}function c(r){i({shift:r})}function l(r){i({vshift:r})}function f(r){return o.add(r),()=>o.delete(r)}return{get:s,set:i,setCoeffs:n,setShift:c,setVShift:l,subscribe:f}}let _={};function Ee(e){const t=typeof document<"u"&&document.body.classList.contains("dark");let o="#ffffff",s="#ffffff",i="#e5e9f2",n="#d7dde8",c="#0b1323";if(t&&typeof window<"u"){const f=getComputedStyle(document.body),r=f.getPropertyValue("--surface-card").trim(),a=f.getPropertyValue("--surface-alt").trim(),m=f.getPropertyValue("--color-grid").trim(),y=f.getPropertyValue("--color-border").trim(),b=f.getPropertyValue("--color-ink").trim();o=r||"#273240",s=a||o,i=m||"#445264",n=y||"#445264",c=b||"#f2f6fa"}const l={margin:{l:54,r:12,t:16,b:44},paper_bgcolor:o,plot_bgcolor:s,font:{color:c},xaxis:{title:{text:"OS  ➝  DS",font:{size:12,weight:0},standoff:12},zeroline:!0,zerolinecolor:"#b7791f",gridcolor:i,linecolor:n,mirror:!0,range:e.x,fixedrange:!1},yaxis:{zeroline:!0,zerolinecolor:"#b7791f",gridcolor:i,linecolor:n,mirror:!0,fixedrange:!1},hovermode:"closest",showlegend:!1};return _.x&&_.x.every(f=>isFinite(f))&&(l.xaxis.range=[..._.x]),_.y&&_.y.every(f=>isFinite(f))&&(l.yaxis.range=[..._.y]),l}function $e(e){e._zoomPersistBound||(e.on("plotly_relayout",t=>{const o=t["xaxis.range[0]"]!==void 0&&t["xaxis.range[1]"]!==void 0,s=t["yaxis.range[0]"]!==void 0&&t["yaxis.range[1]"]!==void 0;o&&(_.x=[t["xaxis.range[0]"],t["xaxis.range[1]"]]),s&&(_.y=[t["yaxis.range[0]"],t["yaxis.range[1]"]])}),e.on("plotly_doubleclick",()=>{_={}}),e._zoomPersistBound=!0)}function Z(){_={}}function C(e){return e.toExponential(ye)}function z(e,t,o,s,i,n,c,l,f){const r=document.createElement("div");r.className="coeff-drag",r.innerHTML="<span>±"+(N*100).toFixed(0)+"%</span>",e.appendChild(r);const a=r.querySelector("span");let m=0,y=0,b=!1;const E=g=>Number(String(g).trim().replace(",",".")),M=g=>{g.preventDefault(),g.stopPropagation(),b=!0,r.classList.add("active"),m=g.clientX,y=E(t.value),(!isFinite(y)||y===0)&&(y=s.coeffs[o]),r.setPointerCapture(g.pointerId)},S=g=>{if(!b)return;const v=g.clientX-m,k=Math.max(-1,Math.min(1,v/xe)),T=1+k*N,F=y*T;t.value=C(F),s.coeffs[o]=F,s.shift=L(s.coeffs),i.value=String(s.shift),n.textContent=(s.shift*1e3).toFixed(2),a.textContent=(k*N*100).toFixed(1)+"%",c()},B=g=>{b&&(b=!1,r.classList.remove("active"),a.textContent="±"+(N*100).toFixed(0)+"%",r.releasePointerCapture(g.pointerId),l(),f&&f())};r.addEventListener("pointerdown",M),r.addEventListener("pointermove",S),r.addEventListener("pointerup",B),r.addEventListener("pointerleave",B)}function q(e,t,o){const s=new Date(Date.now()+o*864e5).toUTCString();document.cookie=`${e}=${encodeURIComponent(t)}; expires=${s}; path=/`}function J(e){const t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([.$?*|{}()\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}function K(){const e=J("coeffA123");if(!e)return{coeffs:null,dark:null};const t=e.split("|");if(t.length<4)return{coeffs:null,dark:null};const o=t.slice(0,4).map(n=>Number(n));if(o.some(n=>!isFinite(n)))return{coeffs:null,dark:null};const s={a1:o[0],a2:o[1],a3:o[2],a4:o[3]},i=t.length>=5?t[4]==="1":null;return{coeffs:s,dark:i}}function re(e,t){const{a1:o,a2:s,a3:i,a4:n}=e;q("coeffA123",`${o}|${s}|${i}|${n}|${t?"1":"0"}`,365)}function we(e,t){const o=K();re(o.coeffs??t,e)}const D=e=>Number(String(e).trim().replace(",","."));function Q(e,t){const{a2:o,a3:s}=e;if(!isFinite(o)||!isFinite(s)||!isFinite(t))return"—";const n=.5*(-2*o-6*s*t)*1e6;if(!isFinite(n))return"—";const c=Math.abs(n);return c>=1e3?n.toExponential(2):n.toFixed(c>=100?1:c>=10?2:3)}function Le(e,t){const o=w("a1"),s=w("a2"),i=w("a3"),n=w("a4"),c=K();c.coeffs&&(e.coeffs={...e.coeffs,...c.coeffs},e.shift=L(e.coeffs));const l={...e.coeffs};[o,s,i,n].forEach(h=>{const d=h.parentElement;if(!(!d||!d.classList.contains("coeff"))&&!h.closest(".coeff-row")){const u=document.createElement("div");u.className="coeff-row",h.replaceWith(u),u.appendChild(h);const p=document.createElement("button");p.type="button",p.className="flip-btn",p.textContent="±",p.title="Flip sign",u.appendChild(p)}});const f=[{btn:o.parentElement.querySelector(".flip-btn"),key:"a1",input:o},{btn:s.parentElement.querySelector(".flip-btn"),key:"a2",input:s},{btn:i.parentElement.querySelector(".flip-btn"),key:"a3",input:i},{btn:n.parentElement.querySelector(".flip-btn"),key:"a4",input:n}],r=w("shift"),a=w("vshift"),m=w("crownMM"),y=w("vshiftMM"),b=w("crownVal"),E=w("npts"),M=document.getElementById("flipPairBtn"),S=document.getElementById("resetCoeffsBtn"),B=document.getElementById("tokenCoeffsBtn"),g=()=>{document.activeElement!==o&&(o.value=C(e.coeffs.a1)),document.activeElement!==s&&(s.value=C(e.coeffs.a2)),document.activeElement!==i&&(i.value=C(e.coeffs.a3)),document.activeElement!==n&&(n.value=C(e.coeffs.a4)),r.value=String(e.shift),a.value=String(e.vshift??0),m.textContent=(e.shift*1e3).toFixed(2),b.textContent=Q(e.coeffs,e.shift),y.textContent=((e.vshift??0)*1e3).toFixed(2),E.textContent=String(e.x.length)};g();const v=()=>re(e.coeffs,document.body.classList.contains("dark")),k=()=>{const h=D(o.value),d=D(s.value),u=D(i.value),p=D(n.value);[h,d,u,p].some($=>!isFinite($))||(e.coeffs={a1:h,a2:d,a3:u,a4:p},e.shift=L(e.coeffs),g(),t(),v())},T=(h,d)=>{const u=D(h.value);if(!isFinite(u)){h.value=C(e.coeffs[d]);return}e.coeffs[d]=u,e.shift=L(e.coeffs),h.value=C(e.coeffs[d]),g(),t(),v()};[o,s,i,n].forEach(h=>h.addEventListener("input",k)),o.addEventListener("blur",()=>T(o,"a1")),s.addEventListener("blur",()=>T(s,"a2")),i.addEventListener("blur",()=>T(i,"a3")),n.addEventListener("blur",()=>T(n,"a4"));const F=[o,s,i,n,r,a];F.forEach((h,d)=>h.addEventListener("keydown",u=>{if(u.key==="Enter"){u.preventDefault();const p=F[d+1];p?p.focus():h.blur()}})),r.addEventListener("input",()=>{e.shift=Number(r.value),m.textContent=(e.shift*1e3).toFixed(2),Z(),b.textContent=Q(e.coeffs,e.shift),t()}),a.addEventListener("input",()=>{e.vshift=Number(a.value),y.textContent=((e.vshift??0)*1e3).toFixed(2),Z(),t()}),z(o.parentElement,o,"a1",e,r,m,t,g,v),z(s.parentElement,s,"a2",e,r,m,t,g,v),z(i.parentElement,i,"a3",e,r,m,t,g,v),z(n.parentElement,n,"a4",e,r,m,t,g,v),[o,s,i,n].forEach(h=>{const d=h.parentElement;if(!d)return;const u=d.querySelector(".coeff-drag"),p=d.querySelector(".flip-btn");if(u&&p){const $=Array.from(d.children);$[1]!==u&&d.insertBefore(u,$[1]||null),u.nextElementSibling!==p&&u.after(p)}}),o.tabIndex=1,s.tabIndex=2,i.tabIndex=3,n.tabIndex=4;const I=[o,s,i,n];return I.forEach((h,d)=>{h.addEventListener("keydown",u=>{if(u.key==="Tab"){if(!u.shiftKey&&d===I.length-1){u.preventDefault();const p=I[0];p.focus(),p.select()}else if(u.shiftKey&&d===0){u.preventDefault();const p=I[I.length-1];p.focus(),p.select()}}})}),f.forEach(({btn:h,key:d,input:u})=>{h&&h.addEventListener("click",()=>{const p=e.coeffs[d];typeof p!="number"||!isFinite(p)||(e.coeffs[d]=-p,u.value=C(e.coeffs[d]),e.shift=L(e.coeffs),g(),t(),v())})}),M&&M.addEventListener("click",()=>{const{a1:h,a3:d}=e.coeffs;isFinite(h)&&(e.coeffs.a1=-h),isFinite(d)&&(e.coeffs.a3=-d),e.shift=L(e.coeffs),g(),t(),v()}),S&&S.addEventListener("click",()=>{e.coeffs={...l},e.shift=L(e.coeffs),g(),t(),v()}),B&&B.addEventListener("click",()=>{e.coeffs={...se},e.shift=L(e.coeffs),g(),t(),v()}),{refresh:g}}function w(e){const t=document.getElementById(e);if(!t)throw new Error(`#${e} not found`);return t}function _e(e=document){const t=window;t.MathJax&&t.MathJax.typesetPromise&&t.MathJax.typesetPromise([e])}const ke=String.raw`
Assuming we have at most 3rd order polynomials, the diameter of the top roll is given by
$$D(x) = a_1 x + a_2 x^2 + a_3 x^3$$
Then the bottom contour of the top roll $T(x)$ is described by
$$
\red{T(x)}=\tfrac12 d(-x)=\tfrac12 a_1 x + \tfrac12 a_2 x^2 + \tfrac12 a_3 x^3
$$
Similarly, we define the top contour of the bottom roll by
$$
\blue{B(x)}=-T(-x)
$$
Why? Well, it has to be point-symmetric around the origin in relation to $t(x)$. \nl
The gap profile at every $x$, when applying a shift $s$ is given by
$$
\begin{align*}
G(s,x) &= {T(x-s)} - {B(x+s)} = T(x-s)+T(-x-s) \\
&=\tfrac{a_1}2{(x-s)} + \tfrac{a_2}2{(x-s)^2} + \tfrac{a_3}2{(x-s)^3}
  + \big[\tfrac{a_1}2{(-x-s)} + \tfrac{a_2}2{(-x-s)^2} + \tfrac{a_3}2{(-x-s)^3}\big] \\
&=\tfrac{a_1}2\big[{(x-s)}+{(-x-s)}\big]
  +\tfrac{a_2}2\big[{(x-s)^2}+{(-x-s)^2}\big]
  +\tfrac{a_3}2\big[{(x-s)^3}+{(-x-s)^3}\big] \\
&=-a_1s + a_2(x^2 + s^2) + a_3(-3sx^2 - s^3) \\
&=-a_1s + a_2s^2 - a_3s^3 + x^2(a_2 - 3a_3s)
\end{align*}
$$
Thus we can define
$$c(s)=a_2 - 3a_3s,$$
which describes the quadratic contour part of the gap. On the other hand, we can state the inverse relationship
$$
s(c)=\frac{a_2-c}{3a_3}.
$$
What do we observe? First, $s(0)=\frac{-a_2}{3a_3}$. This is the shift position for which the gap is "constant" along the width, \nl
i.e. the quadratic part vanishes entirely. \nl
Moreover, the slope of the shift-gap relationship solely depends on the sign of $a_3$. \nl
So what about the equivalent crown? Well, from the perspective of the roll, the signs switch completly!


\nl\nl\nl

$$
=\,a(2s)
  +b\big(2x^2+2s^2\big)
  +c\big(6sx^2+2s^3\big)
$$

$$
=\,2as+\underbrace{(2b+6cs)}_{c(s)}x^2+2bs^2+2cs^3
$$

$$
\text{Thus } c(s)=2b+6cs
\quad\Rightarrow\quad
c(s)=0 \;\; \Longleftrightarrow \;\; s=-\frac{b}{3c}.
$$



### Polynomial Model

The top roll diameter profile $D(x)$ is modeled by a polynomial in normalized lateral position $x \in [-1,1]$:

$$ D(x) = a_1 x + a_2 x^2 + a_3 x^3 + a_4 x^4 $$

Coefficients can be typed directly or adjusted by dragging the numeric overlays. The lateral shift $\hat{x}$ is recomputed from coefficients to recenter the profile.

### Crown Metric

The displayed crown in micrometers is computed from the coefficients and the shift:

$$ C = -2 a_2 - 6 a_3 \, \hat{x} $$

where $\hat{x}$ is the automatically chosen shift.

### Vertical Shift

The vertical shift adds a constant offset to the diameter curve for visual alignment; it does not change the crown formula.

### Drag & Drop Text

You can drag a .txt file onto the main plot to inspect its contents in a movable popup. This help window uses the same component infrastructure.

### Shortcuts & Tips

- Enter moves to the next input
- Horizontal shift slider adjusts lateral alignment
- Vertical shift slider makes fine visual adjustments (in mm shown below)
- You can re-open this help at any time with the Usage / Formulas button

Math is rendered client-side via MathJax.
`;function Te(){const e=document.getElementById("helpBtn");e&&(e.addEventListener("click",()=>ee()),J("helpOpened")==="1"&&setTimeout(()=>{document.querySelector(".help-popup")||ee()},0))}function ee(){document.querySelectorAll(".help-popup").forEach(n=>n.remove());const e=document.createElement("div");e.className="text-popup help-popup card",e.innerHTML=`
    <div class="text-popup__header">
      <strong class="text-popup__title">Usage & Formulas</strong>
      <div class="text-popup__actions">
        <button type="button" class="text-popup__max" aria-label="Maximize" title="Maximize">⛶</button>
        <button type="button" class="text-popup__close" aria-label="Close">✕</button>
      </div>
    </div>
    <div class="text-popup__body">${Me(ke)}</div>
  `,document.body.appendChild(e),e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)";const t=e.querySelector(".text-popup__close"),o=e.querySelector(".text-popup__max"),s=e.querySelector(".text-popup__header"),i=n=>{o&&(n?(e.classList.add("help-popup--max"),e.style.transform="translate(-50%,-50%)",e.style.top="50%",e.style.left="50%",e.style.width="90vw",e.style.height="90vh",e.style.maxWidth="90vw",e.style.maxHeight="90vh",o.textContent="↙",o.title="Restore",o.setAttribute("aria-label","Restore")):(e.classList.remove("help-popup--max"),e.style.width="720px",e.style.maxWidth="760px",e.style.height="",e.style.maxHeight="72vh",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",o.textContent="⛶",o.title="Maximize",o.setAttribute("aria-label","Maximize")))};t&&(t.addEventListener("pointerdown",n=>n.stopPropagation()),t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),q("helpOpened","",-1),e.remove()})),o&&(o.addEventListener("pointerdown",n=>n.stopPropagation()),o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();const c=!e.classList.contains("help-popup--max");i(c),q("helpMax",c?"1":"0",365)})),s&&s.addEventListener("dblclick",n=>{n.preventDefault(),n.stopPropagation();const c=!e.classList.contains("help-popup--max");i(c),q("helpMax",c?"1":"0",365)}),i(J("helpMax")==="1"),Ce(e.querySelector(".text-popup__header"),e),_e(e),q("helpOpened","1",365)}function Ce(e,t){if(!e)return;e.style.cursor="move";let o=0,s=0,i=0,n=0,c=!1;const l=a=>{if(c=!0,o=a.clientX,s=a.clientY,t.style.transform){const y=t.getBoundingClientRect();t.style.transform="",t.style.left=y.left+"px",t.style.top=y.top+"px"}const m=t.getBoundingClientRect();i=m.left,n=m.top,t.style.position="fixed",e.setPointerCapture(a.pointerId)},f=a=>{c&&(t.style.left=i+a.clientX-o+"px",t.style.top=n+a.clientY-s+"px")},r=a=>{if(c){c=!1;try{e.releasePointerCapture(a.pointerId)}catch{}}};e.addEventListener("pointerdown",l),e.addEventListener("pointermove",f),e.addEventListener("pointerup",r),e.addEventListener("pointerleave",r)}function Me(e){const t=[],o=e.replace(/\r\n?/g,`
`).split(/\n/);let s=[];const i=()=>{if(!s.length)return;const n=s.join(`
`).trimEnd();n.trim()&&t.push({type:"para",content:n}),s=[]};for(let n=0;n<o.length;n++){let c=o[n];const l=c.trim();if(l===""){i();continue}if(l==="$$"){i();let f=[];for(n++;n<o.length&&o[n].trim()!=="$$";)f.push(o[n]),n++;t.push({type:"display",content:`$$
`+f.join(`
`)+`
$$`});continue}if(/^\$\$.*\$\$\s*%?\s*$/.test(l)){i(),t.push({type:"display",content:l.replace(/\s*%\s*$/,"")});continue}s.push(c)}return i(),t.map(n=>n.type==="display"?n.content:Se(n.content)).join(`
`)}function Se(e){const t=e.trim();if(!t)return"";if(/^###\s+/.test(t)){const s=t.replace(/^###\s+/,"").trim();return`<h3>${G(s)}</h3>`}const o=t.split(/\n/);return o.every(s=>!s||/^-\s+/.test(s))?`<ul>${o.filter(i=>i).map(i=>`<li>${te(i.replace(/^-\s+/,"").trim())}</li>`).join("")}</ul>`:`<p>${te(o.join(" ").replace(/\s+/g," ").trim())}</p>`}function te(e){const t=[];let o=0;const s=/\${1,2}[^$]+?\${1,2}/g;let i;const n="\0BR\0",c=r=>r.replace(/[ \t]*\\nl[ \t]*/g,n);for(;i=s.exec(e);){const r=e.slice(o,i.index);if(r){const a=c(r);t.push(G(a))}t.push(i[0]),o=i.index+i[0].length}const l=e.slice(o);if(l){const r=c(l);t.push(G(r))}let f=t.join("");return f=f.replace(new RegExp(n,"g"),"<br/>"),f}function G(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Be(e,t){Le(e,t),Te()}function Fe(e){const{coeffs:t,shift:o,vshift:s=0,x:i}=e,n=typeof document<"u"&&document.body.classList.contains("dark"),c=n?.3:.1,l=n?.3:.1,f=n?"#ffd6cf":"#b91c1c",r=n?"#cfe8ff":"#1d4ed8",a="Top",m="Bottom",y=14,b=i.map(x=>x+o),E=i.map(x=>x-o),M=A(i,t),S=W(i,t),B=A([-1],t)[0],g=A([1],t)[0],v=B>=g?-1:1,k=v===-1?1:-1,T=A([v],t)[0],F=W([k],t)[0],I=M.map(x=>-x+2*T),h=S.map(x=>-x+2*F),d=M.map(x=>x+s),u=I.map(x=>x+s),p=S.map(x=>x-s),$=h.map(x=>x-s),ae=j(o,t),le=me(i,o,t).map(x=>x-ae),fe=[...b,...b.slice().reverse()],de=[...d,...u.slice().reverse()],ue=[...E,...E.slice().reverse()],pe=[...p,...$.slice().reverse()];return{traces:[{x:ue,y:pe,fill:"toself",fillcolor:`rgba(0,114,206,${l})`,line:{width:0},hoverinfo:"skip"},{x:fe,y:de,fill:"toself",fillcolor:`rgba(214,45,32,${c})`,line:{width:0},hoverinfo:"skip"},{x:[E[0],E[0]],y:[p[0],$[0]],mode:"lines",line:{width:2,color:"#0072ce"},hoverinfo:"skip",showlegend:!1},{x:[E[E.length-1],E[E.length-1]],y:[p[p.length-1],$[$.length-1]],mode:"lines",line:{width:2,color:"#0072ce"},hoverinfo:"skip",showlegend:!1},{x:[b[0],b[0]],y:[d[0],u[0]],mode:"lines",line:{width:2,color:"#d62d20"},hoverinfo:"skip",showlegend:!1},{x:[b[b.length-1],b[b.length-1]],y:[d[d.length-1],u[u.length-1]],mode:"lines",line:{width:2,color:"#d62d20"},hoverinfo:"skip",showlegend:!1},{x:b,y:d,name:`top (head @ ${v===-1?"-1":"+1"})`,mode:"lines",line:{width:2,color:"#d62d20"}},{x:b,y:u,name:"top mirror",mode:"lines",line:{width:2,color:"#d62d20"}},{x:E,y:p,name:`bottom (head @ ${k===-1?"-1":"+1"})`,mode:"lines",line:{width:2,color:"#0072ce"}},{x:E,y:$,name:"bottom mirror",mode:"lines",line:{width:2,color:"#0072ce"}},{x:i,y:le,name:"d(x, shift) − const",mode:"lines",line:{width:2,dash:"dash",color:"#6b7280"}},(()=>{const x=Math.floor(i.length/2);return{x:[b[x]],y:[(d[x]+u[x])/2],text:[a],mode:"text",textfont:{color:f,size:y},hoverinfo:"skip",showlegend:!1}})(),(()=>{const x=Math.floor(i.length/2);return{x:[E[x]],y:[(p[x]+$[x])/2],text:[m],mode:"text",textfont:{color:r,size:y},hoverinfo:"skip",showlegend:!1}})()],headSide:v,bottomHeadSide:k}}function Ie(e){const t=document.getElementById("polyPlot");if(!t)return;const{x:o,coeffs:s}=e,i=o.map(r=>j(r,s)),n=typeof document<"u"&&document.body.classList.contains("dark");let c="#eee",l="#444",f="#ffffff";if(n){const r=getComputedStyle(document.body),a=r.getPropertyValue("--surface-alt").trim(),m=r.getPropertyValue("--color-ink").trim(),y=r.getPropertyValue("--color-grid").trim();f=a||"#2f3d4c",c=y||"#445264",l=m||"#f2f6fa"}Plotly.react(t,[{x:o,y:i,mode:"lines",line:{width:2,color:l},hoverinfo:"x+y"}],{margin:{l:30,r:6,t:4,b:24},paper_bgcolor:f,plot_bgcolor:f,xaxis:Object.assign({tickfont:{size:10,color:n?"#e5e7eb":"#0b1323"},title:"",gridcolor:c,linecolor:c},n?{zeroline:!0,zerolinecolor:"#ffffff"}:{}),yaxis:Object.assign({tickfont:{size:10,color:n?"#e5e7eb":"#0b1323"},title:"",gridcolor:c,linecolor:c},n?{zeroline:!0,zerolinecolor:"#ffffff"}:{}),showlegend:!1},{displayModeBar:!1,staticPlot:!1,responsive:!0})}function X(e){const t=document.getElementById("plot");if(!t)return;const{traces:o}=Fe(e),s=document.getElementById("shift");let i=-1,n=1;if(s){const f=parseFloat(s.min),r=parseFloat(s.max);if(isFinite(f)&&isFinite(r)){const a=Math.max(Math.abs(f),Math.abs(r));i=-1-a,n=1+a}}const c=Ee({x:[i,n]}),l={displayModeBar:!1,responsive:!0,staticPlot:!1};Plotly.react(t,o,c,l),$e(t),Ie(e)}function Pe(e){const t=document.body;let o=0;const s=()=>e.classList.add("drop-hover"),i=()=>e.classList.remove("drop-hover"),n=r=>{r.dataTransfer&&ne(r.dataTransfer)&&(o++,r.preventDefault(),s())},c=r=>{r.dataTransfer&&ne(r.dataTransfer)&&(r.preventDefault(),r.dataTransfer.dropEffect="copy")},l=r=>{if(!r.relatedTarget||!t.contains(r.relatedTarget)){o=0,i();return}o=Math.max(0,o-1),o===0&&i()},f=r=>{if(!r.dataTransfer)return;r.preventDefault(),o=0,i();const a=[...r.dataTransfer.files].find(y=>De(y));if(!a)return;const m=new FileReader;m.onload=()=>{const y=String(m.result??"");Ae(a.name,y)},m.readAsText(a)};t.addEventListener("dragenter",n),t.addEventListener("dragover",c),t.addEventListener("dragleave",l),t.addEventListener("drop",f),window.addEventListener("dragover",r=>r.preventDefault()),window.addEventListener("drop",r=>r.preventDefault())}function ne(e){return[...e.items||[]].some(t=>t.kind==="file"&&/text|plain/.test(t.type)||/\.txt$/i.test(t.getAsFile()?.name||""))}function De(e){return/text|plain/.test(e.type)||/\.txt$/i.test(e.name)}function Ae(e,t){let s=!1;t.length>1e5&&(t=t.slice(0,1e5)+`
… (truncated)`,s=!0);const i=document.querySelector(".text-popup");i&&i.remove();const n=document.createElement("div");n.className="text-popup card",n.innerHTML=`
    <div class="text-popup__header">
      <strong class="text-popup__title" title="${U(e)}">${U(e)}</strong>
      <div class="text-popup__actions">
        ${s?'<span class="text-popup__trunc">truncated</span>':""}
        <button type="button" class="text-popup__close" aria-label="Close">✕</button>
      </div>
    </div>
    <pre class="text-popup__body"><code>${U(t)}</code></pre>
  `,document.body.appendChild(n);const c=n.querySelector(".text-popup__header"),l=n.querySelector(".text-popup__close");l&&(l.addEventListener("pointerdown",f=>f.stopPropagation()),l.addEventListener("click",f=>{f.preventDefault(),n.remove()})),qe(c,n)}function U(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function qe(e,t){if(!e)return;e.style.cursor="move";let o=0,s=0,i=0,n=0,c=!1;const l=a=>{if(a.target.closest(".text-popup__actions"))return;c=!0,o=a.clientX,s=a.clientY;const m=t.getBoundingClientRect();i=m.left,n=m.top,t.style.position="fixed",e.setPointerCapture(a.pointerId)},f=a=>{if(!c)return;const m=a.clientX-o,y=a.clientY-s;t.style.left=i+m+"px",t.style.top=n+y+"px"},r=a=>{if(c){c=!1;try{e.releasePointerCapture(a.pointerId)}catch{}}};e.addEventListener("pointerdown",l),e.addEventListener("pointermove",f),e.addEventListener("pointerup",r),e.addEventListener("pointerleave",r)}const R="__dbgHoverOutline",O="__dbgInspector",H="__dbgToast";function Re(){document.body.classList.contains("debug")&&(Ne(),ze(),Ve(),Xe())}function Oe(){document.querySelectorAll("[data-debug]").forEach(e=>e.removeAttribute("data-debug")),[R,O,H].forEach(e=>{const t=document.getElementById(e);t&&t.remove()}),document.body.classList.remove("debug-dim")}function Ne(){if(!document.getElementById(R)){const e=document.createElement("div");e.id=R,e.className="debug-hover-outline",document.body.appendChild(e)}if(!document.getElementById(O)){const e=document.createElement("div");e.id=O,e.className="debug-inspector",document.body.appendChild(e)}if(!document.getElementById(H)){const e=document.createElement("div");e.id=H,e.className="debug-toast",document.body.appendChild(e)}}function ze(){document.querySelectorAll("div").forEach(e=>{if(!e.hasAttribute("data-debug")){const t=e.id?`#${e.id}`:"",o=[...e.classList].join(".")||"";(t||o)&&e.setAttribute("data-debug",`div${t}${o?"."+o:""}`)}})}function Ve(){const e=document.getElementById(R),t=document.getElementById(O),o=document.getElementById(H);let s=null;document.addEventListener("pointermove",i=>{const n=i.target;if(!document.body.classList.contains("debug")||!n||n===document.body||n.id===R||n.id===O)return;if(s===n){oe(t,i.clientX,i.clientY);return}s=n;const c=n.getBoundingClientRect();e.style.left=c.left+"px",e.style.top=c.top+"px",e.style.width=c.width+"px",e.style.height=c.height+"px",t.innerHTML=He(n,c),oe(t,i.clientX,i.clientY)},{passive:!0}),document.addEventListener("click",i=>{if(!document.body.classList.contains("debug"))return;const n=i.target;if(!n)return;i.preventDefault(),i.stopPropagation();const c=ce(n);c&&(navigator.clipboard.writeText(c).catch(()=>{}),je(o,`Copied: ${c}`))},!0)}function oe(e,t,o){const s=window.innerWidth,i=window.innerHeight,n=e.getBoundingClientRect();let c=t+10,l=o+10;c+n.width>s-8&&(c=s-n.width-8),l+n.height>i-8&&(l=i-n.height-8),e.style.left=c+"px",e.style.top=l+"px"}function He(e,t){const o=e.tagName.toLowerCase(),s=e.id?`#${e.id}`:"",i=[...e.classList].join(".")||"",n=`${Math.round(t.width)}×${Math.round(t.height)}`,c=ce(e);return`<strong>${o}${s}${i?"."+i:""}</strong> <code>${n}</code><br/><code>${Ue(c||"")}</code>`}function ce(e){if(!(e instanceof Element))return null;const t=[];let o=e;for(;o&&o!==document.body;){let s=o.tagName.toLowerCase();if(o.id){s=`#${o.id}`,t.unshift(s);break}const i=[...o.classList].slice(0,3).join(".");if(i)s+="."+i.replace(/\.+/g,".");else{const n=Array.from(o.parentElement?.children||[]).filter(c=>c.tagName===o.tagName);if(n.length>1){const c=n.indexOf(o)+1;s+=`:nth-of-type(${c})`}}t.unshift(s),o=o.parentElement}return t.join(" > ")}function je(e,t){e.textContent=t,e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),1600)}function Xe(){document.addEventListener("keydown",e=>{document.body.classList.contains("debug")&&e.key==="d"&&document.body.classList.toggle("debug-dim")})}function Ue(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}(()=>{const{dark:e}=K();e&&document.body.classList.add("dark")})();const P=ve(be());Be(P.get(),()=>X(P.get()));X(P.get());const ie=document.getElementById("plot");ie&&Pe(ie);P.subscribe(()=>X(P.get()));const Y=document.getElementById("debugToggle");Y&&Y.addEventListener("change",()=>{const e=Y.checked;document.body.classList.toggle("debug",e),e?requestAnimationFrame(()=>Re()):Oe()});const V=document.getElementById("darkToggle");V&&(V.checked=document.body.classList.contains("dark"),V.addEventListener("change",()=>{document.body.classList.add("theme-changing"),requestAnimationFrame(()=>{const e=V.checked;document.body.classList.toggle("dark",e),we(e,P.get().coeffs),setTimeout(()=>document.body.classList.remove("theme-changing"),60),X(P.get())})}));
