(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function R(e,t,n){const r=new Array(n),i=(t-e)/(n-1);for(let o=0;o<n;o++)r[o]=e+o*i;return r}function M(e,t){return t.a1*e+t.a2*e*e+t.a3*e*e*e+t.a4*e*e*e*e}function z(e,t){const n=e.map(r=>M(+r,t));return n.reverse(),n.map(r=>.5*r)}function q(e,t){const n=e.map(r=>M(-r,t));return n.reverse(),n.map(r=>-.5*r)}function k(e,t,n){const r=e.map(l=>l+t),i=e.map(l=>l-t),o=z(r,n),a=q(i,n);return o.map((l,c)=>l-a[c])}function S(e){return 3*e.a3,0}const V=50,C=.5,G=160,Y=6;function U(){return{coeffs:{a1:-.000276329818577996,a2:.0002052381459230004,a3:.0007542456220678692,a4:0},shift:0,vshift:0,x:R(-1,1,V)}}function j(e){let t={...e,shift:S(e.coeffs)};const n=new Set;function r(){return t}function i(s){t={...t,...s},n.forEach(f=>f())}function o(s,f=!0){const d={coeffs:s};f&&(d.shift=S(s)),i(d)}function a(s){i({shift:s})}function l(s){i({vshift:s})}function c(s){return n.add(s),()=>n.delete(s)}return{get:r,set:i,setCoeffs:o,setShift:a,setVShift:l,subscribe:c}}let b={};function K(e){const t={margin:{l:54,r:12,t:16,b:44},paper_bgcolor:"#ffffff",plot_bgcolor:"#ffffff",xaxis:{title:"x",zeroline:!0,zerolinecolor:"#b7791f",gridcolor:"#e5e9f2",linecolor:"#d7dde8",mirror:!0,range:e.x,fixedrange:!1},yaxis:{title:"y",zeroline:!0,zerolinecolor:"#b7791f",gridcolor:"#e5e9f2",linecolor:"#d7dde8",mirror:!0,fixedrange:!1},hovermode:"closest",showlegend:!1};return b.x&&b.x.every(n=>isFinite(n))&&(t.xaxis.range=[...b.x]),b.y&&b.y.every(n=>isFinite(n))&&(t.yaxis.range=[...b.y]),t}function Z(e){e._zoomPersistBound||(e.on("plotly_relayout",t=>{const n=t["xaxis.range[0]"]!==void 0&&t["xaxis.range[1]"]!==void 0,r=t["yaxis.range[0]"]!==void 0&&t["yaxis.range[1]"]!==void 0;n&&(b.x=[t["xaxis.range[0]"],t["xaxis.range[1]"]]),r&&(b.y=[t["yaxis.range[0]"],t["yaxis.range[1]"]])}),e.on("plotly_doubleclick",()=>{b={}}),e._zoomPersistBound=!0)}function N(){b={}}function L(e){return e.toExponential(Y)}function I(e,t,n,r,i,o,a,l){const c=document.createElement("div");c.className="coeff-drag",c.innerHTML="<span>±"+(C*100).toFixed(0)+"%</span>",e.appendChild(c);const s=c.querySelector("span");let f=0,d=0,p=!1;const E=u=>Number(String(u).trim().replace(",",".")),g=u=>{u.preventDefault(),u.stopPropagation(),p=!0,c.classList.add("active"),f=u.clientX,d=E(t.value),(!isFinite(d)||d===0)&&(d=r.coeffs[n]),c.setPointerCapture(u.pointerId)},F=u=>{if(!p)return;const v=u.clientX-f,h=Math.max(-1,Math.min(1,v/G)),w=1+h*C,T=d*w;t.value=L(T),r.coeffs[n]=T,r.shift=S(r.coeffs),i.value=String(r.shift),o.textContent=(r.shift*1e3).toFixed(2),s.textContent=(h*C*100).toFixed(1)+"%",a()},m=u=>{p&&(p=!1,c.classList.remove("active"),s.textContent="±"+(C*100).toFixed(0)+"%",c.releasePointerCapture(u.pointerId),l())};c.addEventListener("pointerdown",g),c.addEventListener("pointermove",F),c.addEventListener("pointerup",m),c.addEventListener("pointerleave",m)}const _=e=>Number(String(e).trim().replace(",","."));function D(e,t){const{a2:n,a3:r}=e;if(!isFinite(n)||!isFinite(r)||!isFinite(t))return"—";const o=(-2*n-6*r*t)*1e6;if(!isFinite(o))return"—";const a=Math.abs(o);return a>=1e3?o.toExponential(2):o.toFixed(a>=100?1:a>=10?2:3)}function J(e,t){const n=y("a1"),r=y("a2"),i=y("a3"),o=y("a4"),a=y("shift"),l=y("vshift"),c=y("crownMM"),s=y("vshiftMM"),f=y("crownVal"),d=y("npts"),p=()=>{document.activeElement!==n&&(n.value=L(e.coeffs.a1)),document.activeElement!==r&&(r.value=L(e.coeffs.a2)),document.activeElement!==i&&(i.value=L(e.coeffs.a3)),document.activeElement!==o&&(o.value=L(e.coeffs.a4)),a.value=String(e.shift),l.value=String(e.vshift??0),c.textContent=(e.shift*1e3).toFixed(2),f.textContent=D(e.coeffs,e.shift),s.textContent=((e.vshift??0)*1e3).toFixed(2),d.textContent=String(e.x.length)};p();const E=()=>{const m=_(n.value),u=_(r.value),v=_(i.value),h=_(o.value);[m,u,v,h].some(w=>!isFinite(w))||(e.coeffs={a1:m,a2:u,a3:v,a4:h},e.shift=S(e.coeffs),a.value=String(e.shift),c.textContent=(e.shift*1e3).toFixed(2),f.textContent=D(e.coeffs,e.shift),l.value=String(e.vshift??0),s.textContent=((e.vshift??0)*1e3).toFixed(2),t())},g=(m,u)=>{const v=_(m.value);if(!isFinite(v)){m.value=L(e.coeffs[u]);return}e.coeffs[u]=v,e.shift=S(e.coeffs),m.value=L(e.coeffs[u]),p(),t()};[n,r,i,o].forEach(m=>{m.addEventListener("input",E)}),n.addEventListener("blur",()=>g(n,"a1")),r.addEventListener("blur",()=>g(r,"a2")),i.addEventListener("blur",()=>g(i,"a3")),o.addEventListener("blur",()=>g(o,"a4"));const F=[n,r,i,o,a,l];return F.forEach((m,u)=>m.addEventListener("keydown",v=>{if(v.key==="Enter"){v.preventDefault();const h=F[u+1];h?h.focus():m.blur()}})),a.addEventListener("input",()=>{e.shift=Number(a.value),c.textContent=(e.shift*1e3).toFixed(2),N(),f.textContent=D(e.coeffs,e.shift),t()}),l.addEventListener("input",()=>{e.vshift=Number(l.value),s.textContent=((e.vshift??0)*1e3).toFixed(2),N(),t()}),I(n.parentElement,n,"a1",e,a,c,t,p),I(r.parentElement,r,"a2",e,a,c,t,p),I(i.parentElement,i,"a3",e,a,c,t,p),I(o.parentElement,o,"a4",e,a,c,t,p),{refresh:p}}function y(e){const t=document.getElementById(e);if(!t)throw new Error(`#${e} not found`);return t}function Q(e,t){J(e,t)}function W(e){const{coeffs:t,shift:n,vshift:r=0,x:i}=e,o=i.map(x=>x+n),a=i.map(x=>x-n),l=z(i,t),c=q(i,t);.5*M(1,t),-.5*M(1,t);const s=Math.max(...l),f=Math.min(...c),d=l.map(x=>x+r),p=l.map(x=>2*s-x+r),E=c.map(x=>x-r),g=c.map(x=>2*f-x-r),F=M(n,t),m=k(i,n,t).map(x=>x-F+2*r),u=l.indexOf(s),v=c.indexOf(f);o[u],a[v],d[u],p[u],E[v],g[v];const h=[...o,...o.slice().reverse()],w=[...d,...p.slice().reverse()],T=[...a,...a.slice().reverse()],H=[...E,...g.slice().reverse()];return{traces:[{x:T,y:H,fill:"toself",fillcolor:"rgba(0,114,206,0.10)",line:{width:0},hoverinfo:"skip"},{x:h,y:w,fill:"toself",fillcolor:"rgba(214,45,32,0.10)",line:{width:0},hoverinfo:"skip"},{x:o,y:d,name:"top",mode:"lines",line:{width:2,color:"#d62d20"}},{x:o,y:p,name:"top mirror",mode:"lines",line:{width:2,color:"#d62d20"}},{x:a,y:E,name:"bottom",mode:"lines",line:{width:2,color:"#0072ce"}},{x:a,y:g,name:"bottom mirror",mode:"lines",line:{width:2,color:"#0072ce"}},{x:i,y:m,name:"d(x, shift) − const",mode:"lines",line:{width:2,dash:"dash",color:"#6b7280"}}]}}function ee(e){const t=document.getElementById("polyPlot");if(!t)return;const{x:n,coeffs:r}=e,i=n.map(o=>M(o,r));Plotly.react(t,[{x:n,y:i,mode:"lines",line:{width:2,color:"#444"},hoverinfo:"x+y"}],{margin:{l:30,r:6,t:4,b:24},xaxis:{tickfont:{size:10},title:"",gridcolor:"#eee"},yaxis:{tickfont:{size:10},title:"",gridcolor:"#eee"},showlegend:!1},{displayModeBar:!1,staticPlot:!1,responsive:!0})}function X(e){const t=document.getElementById("plot");if(!t)return;const{traces:n}=W(e),r=document.getElementById("shift");let i=-1,o=1;if(r){const c=parseFloat(r.min),s=parseFloat(r.max);if(isFinite(c)&&isFinite(s)){const f=Math.max(Math.abs(c),Math.abs(s));i=-1-f,o=1+f}}const a=K({x:[i,o]}),l={displayModeBar:!1,responsive:!0,staticPlot:!1};Plotly.react(t,n,a,l),Z(t),ee(e)}function te(e){const t=document.body;let n=0;const r=()=>e.classList.add("drop-hover"),i=()=>e.classList.remove("drop-hover"),o=s=>{s.dataTransfer&&O(s.dataTransfer)&&(n++,s.preventDefault(),r())},a=s=>{s.dataTransfer&&O(s.dataTransfer)&&(s.preventDefault(),s.dataTransfer.dropEffect="copy")},l=s=>{if(!s.relatedTarget||!t.contains(s.relatedTarget)){n=0,i();return}n=Math.max(0,n-1),n===0&&i()},c=s=>{if(!s.dataTransfer)return;s.preventDefault(),n=0,i();const f=[...s.dataTransfer.files].find(p=>ne(p));if(!f)return;const d=new FileReader;d.onload=()=>{const p=String(d.result??"");oe(f.name,p)},d.readAsText(f)};t.addEventListener("dragenter",o),t.addEventListener("dragover",a),t.addEventListener("dragleave",l),t.addEventListener("drop",c),window.addEventListener("dragover",s=>s.preventDefault()),window.addEventListener("drop",s=>s.preventDefault())}function O(e){return[...e.items||[]].some(t=>t.kind==="file"&&/text|plain/.test(t.type)||/\.txt$/i.test(t.getAsFile()?.name||""))}function ne(e){return/text|plain/.test(e.type)||/\.txt$/i.test(e.name)}function oe(e,t){let r=!1;t.length>1e5&&(t=t.slice(0,1e5)+`
… (truncated)`,r=!0);const i=document.querySelector(".text-popup");i&&i.remove();const o=document.createElement("div");o.className="text-popup card",o.innerHTML=`
    <div class="text-popup__header">
      <strong class="text-popup__title" title="${B(e)}">${B(e)}</strong>
      <div class="text-popup__actions">
        ${r?'<span class="text-popup__trunc">truncated</span>':""}
        <button type="button" class="text-popup__close" aria-label="Close">✕</button>
      </div>
    </div>
    <pre class="text-popup__body"><code>${B(t)}</code></pre>
  `,document.body.appendChild(o);const a=o.querySelector(".text-popup__header"),l=o.querySelector(".text-popup__close");l&&(l.addEventListener("pointerdown",c=>c.stopPropagation()),l.addEventListener("click",c=>{c.preventDefault(),o.remove()})),re(a,o)}function B(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function re(e,t){if(!e)return;e.style.cursor="move";let n=0,r=0,i=0,o=0,a=!1;const l=f=>{if(f.target.closest(".text-popup__actions"))return;a=!0,n=f.clientX,r=f.clientY;const d=t.getBoundingClientRect();i=d.left,o=d.top,t.style.position="fixed",e.setPointerCapture(f.pointerId)},c=f=>{if(!a)return;const d=f.clientX-n,p=f.clientY-r;t.style.left=i+d+"px",t.style.top=o+p+"px"},s=f=>{if(a){a=!1;try{e.releasePointerCapture(f.pointerId)}catch{}}};e.addEventListener("pointerdown",l),e.addEventListener("pointermove",c),e.addEventListener("pointerup",s),e.addEventListener("pointerleave",s)}const P=j(U());Q(P.get(),()=>X(P.get()));X(P.get());const $=document.getElementById("plot");$&&te($);P.subscribe(()=>X(P.get()));const A=document.getElementById("debugToggle");A&&A.addEventListener("change",()=>{document.body.classList.toggle("debug",A.checked),A.checked?document.querySelectorAll("div").forEach(e=>{const t=e.id?`#${e.id}`:"",n=[...e.classList].length?"."+[...e.classList].join("."):"";e.setAttribute("data-debug",`div${t}${n}`)}):document.querySelectorAll("div[data-debug]").forEach(e=>e.removeAttribute("data-debug"))});
